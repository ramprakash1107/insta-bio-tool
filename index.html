<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Real Ludo</title>
<style>
body{margin:0;background:#111;color:#fff;font-family:sans-serif;text-align:center}
#board{width:320px;height:320px;margin:10px auto;display:grid;
grid-template-columns:repeat(5,1fr);grid-template-rows:repeat(5,1fr)}
.cell{border:1px solid #333;display:flex;align-items:center;justify-content:center}
.red{background:#e53935}
.green{background:#43a047}
.goti{width:22px;height:22px;border-radius:50%}
#dice{font-size:28px;margin:10px}
button{padding:10px 16px;border:none;border-radius:8px;background:#1d9bf0;color:#fff}
</style>
</head>

<body>

<h3 id="turnText">Loading...</h3>
<div id="board"></div>
<div id="dice">ðŸŽ² -</div>
<button onclick="rollDice()">ROLL</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, set, onValue, update } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyARuO_pN2vdYrVKYkKHHaNys7WI8HqM6I4",
  authDomain: "friendchat-43941.firebaseapp.com",
  databaseURL: "https://friendchat-43941-default-rtdb.firebaseio.com",
  projectId: "friendchat-43941",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const gameRef = ref(db,"ludo/game1");

/* GAME STATE */
const path = [0,1,2,3,4,9,14,19,24];
let myColor = prompt("Enter color: red / green");

set(gameRef,{
  turn:"red",
  dice:0,
  red:{pos:-1},
  green:{pos:-1}
});

/* UI */
const board=document.getElementById("board");
for(let i=0;i<25;i++){
  const d=document.createElement("div");
  d.className="cell";
  d.id="c"+i;
  board.appendChild(d);
}

function draw(state){
  document.querySelectorAll(".cell").forEach(c=>c.innerHTML="");
  ["red","green"].forEach(col=>{
    const p=state[col].pos;
    if(p>=0){
      const g=document.createElement("div");
      g.className="goti "+col;
      document.getElementById("c"+path[p]).appendChild(g);
    }
  });
  document.getElementById("dice").textContent="ðŸŽ² "+state.dice;
  document.getElementById("turnText").textContent="Turn: "+state.turn;
}

/* LISTENER */
onValue(gameRef,snap=>{
  if(snap.exists()) draw(snap.val());
});

/* DICE */
window.rollDice=()=>{
  onValue(gameRef,snap=>{
    const s=snap.val();
    if(s.turn!==myColor) return alert("Turn nahi hai");
    const d=Math.floor(Math.random()*6)+1;
    let me=s[myColor];
    if(me.pos===-1 && d===6) me.pos=0;
    else if(me.pos>=0 && me.pos+d<path.length) me.pos+=d;

    // CUT LOGIC
    const other=myColor==="red"?"green":"red";
    if(me.pos>=0 && me.pos===s[other].pos){
      s[other].pos=-1;
    }

    update(gameRef,{
      dice:d,
      [myColor]:me,
      turn: other
    });
  },{onlyOnce:true});
};
</script>
</body>
</html>
